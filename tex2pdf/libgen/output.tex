\newdimen\topmargin
\newdimen\outermargin
\newdimen\textheight
\newdimen\textwidth
\newdimen\headoffset
\newdimen\translationwidth

\pagewidth=13cm
\pageheight=19.7cm
\topmargin=2.35cm
\outermargin=1.5cm
\textheight=15.85cm
\textwidth=10.2cm
\headoffset=1.65cm
\translationwidth=3.5cm
\maxdepth=3mm

\topskip=1em
\hsize=\textwidth
\vsize=\textheight

\tracingoutput=1
\tracingpages=1

\newbox\partialpage
\newbox\translationbox
\def\storepartialpage{\goodbreak
\begingroup\output={\global\setbox\partialpage=\vbox{\unvbox255}}\eject\endgroup}

\output={\normaloutput\pagebody
\unvbox255 \penalty\outputpenalty}

\def\normaloutput#1{
	\pagesetup
	\shipout\vbox{\showframe\hrule height0pt\makeheadline\hrule height0pt
		\vbox to \textheight{#1}}
	\advancepageno
}

\newtoks\headline
\def\makeheadline{\begingroup
	\setbox0=\hbox to \textwidth{\the\headline}
	\ht0=\headoffset \dp0=0pt \box0
	\dimen0=\topmargin
	\advance\dimen0 by -\topskip
	\advance\dimen0 by -\headoffset
	\kern\dimen0
	\endgroup}

\def\pagebody{\adjustboxes \boxmaxdepth=\maxdepth
	\unvbox\partialpage
	\unvbox1
	\unvbox155}

\def\adjustboxes{\splitmaxdepth=\maxdepth
	\dimen0=\textheight
	\advance\dimen0 by -\ht\partialpage
	\global\setbox255=\vbox{\penalty0\unvbox255}
	\setbox155=\vsplit255 upto \dimen0
	\ifdim\ht155=0pt
		\setbox1=\vbox{}
	\else
		\dimen0=\ifvoid\partialpage\textheight\else\ht155\fi
		\setbox0=\vsplit\translationbox upto \dimen0
		\ht0=0pt \dp0=0pt \wd0=\translationwidth
		\setbox1=\vbox{\hbox to \textwidth{\hfil\box0}}
	\fi
}

\newtoks\framerule
\framerule={\hrule width\textwidth height0.1pt\kern-0.1pt}
\def\showframe{\begingroup
	\dimen0=\topmargin
	\advance\dimen0 by -\topskip
	\setbox0=\vbox{\kern\dimen0\the\framerule\kern\textheight\the\framerule}
	\ht0=0pt \dp0=0pt \box0
	\endgroup}

\def\pagesetup{\hoffset=-1in \voffset=-1in \vbadness=2000
	\ifodd\pageno\oddsetup\else\evensetup\fi}
\def\headerstyle{}
\newtoks\runninghead
\def\oddsetup{\begingroup
\dimen0=\pagewidth
\advance\dimen0 by -\textwidth
\advance\dimen0 by -\outermargin
\global\advance\hoffset by \dimen0
\global\headline={\begingroup\headerstyle\hss\the\runninghead\hss\the\pageno\endgroup}
\endgroup}
\def\evensetup{
\advance\hoffset by \outermargin
\headline={\begingroup\headerstyle\the\pageno\hss\the\runninghead\hss\endgroup}
}

\def\advancepageno{\global\advance\pageno by 1}
