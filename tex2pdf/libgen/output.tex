\newdimen\topmargin
\newdimen\outermargin
\newdimen\textheight
\newdimen\textwidth
\newdimen\headoffset
\newdimen\translationwidth

\pagewidth=13cm
\pageheight=19.7cm
\topmargin=2.4cm
\outermargin=1.5cm
\textheight=15.85cm
\textwidth=10.2cm
\headoffset=1.55cm
\translationwidth=3.5cm
\maxdepth=3mm

\topskip=1em
\hsize=\textwidth
\vsize=\textheight

\tracingoutput=1
\tracingpages=1

\newbox\partialpage
\newbox\translationbox
\def\storepartialpage{\goodbreak
\begingroup\output={\global\setbox\partialpage=\vbox{\unvbox255}}\eject\endgroup}

\output={\normaloutput\pagebody}

\def\normaloutput#1{
	\pagesetup
	\shipout\vbox{\offinterlineskip
		\showframe\makeheadline
		\puttranslationins%
		\vbox to \textheight{#1}}\boxmaxdepth=\maxdepth
	\advancepageno}

\def\pagebody{\unvbox255}

\newtoks\headline
\def\makeheadline{\begingroup
	\setbox0=\hbox to \textwidth{\strut\headoffset\the\headline}
	\dp0=0pt \box0
	\dimen0=\topmargin
	\advance\dimen0 by -\topskip
	\advance\dimen0 by -\headoffset
	\kern\dimen0
	\endgroup}

\newtoks\framerule
\framerule={\hrule width\textwidth height0.1pt\kern-0.1pt}
\def\showframe{\begingroup
	\dimen0=\topmargin
	\advance\dimen0 by -\topskip
	\setbox0=\vbox{\kern\dimen0\the\framerule\kern\textheight\the\framerule}
	\ht0=0pt \dp0=0pt \box0
	\endgroup}
\def\showframe{}

\def\pagesetup{\hoffset=-1in \voffset=-1in \vbadness=2000
	\ifodd\pageno\oddsetup\else\evensetup\fi
	\ifnoheaderthispage
		\global\noheaderthispagefalse\headline={\hss}\fi}

\newtoks\rrunninghead
\newtoks\lrunninghead
\def\oddsetup{\begingroup
\dimen0=\pagewidth
\advance\dimen0 by -\textwidth
\advance\dimen0 by -\outermargin
\global\advance\hoffset by \dimen0
\global\headline={\begingroup\header\hss\the\rrunninghead\hss\the\pageno\endgroup}
\endgroup}
\def\evensetup{
\advance\hoffset by \outermargin
\headline={\begingroup\header\the\pageno\hss\the\lrunninghead\hss\endgroup}
}

\def\advancepageno{\global\advance\pageno by 1}

\newif\ifnoheaderthispage
\def\noheaderthispage{\global\noheaderthispagetrue}

\newif\ifinserthere
\def\puttranslationins{\ifvoid\translationins \global\insertherefalse\else
		\ifinserthere \translation\else\global\insertheretrue\fi\fi}

\def\translation{\rlap{\vbox to 0pt{\hbox to \textwidth{\hfil\box\translationins}\vss}}}
