\def\xrefinit{\directlua{libgen.xref.init("build/\jobname.aux")}}
\def\xrefadditem#1#2{\directlua{libgen.xref.add_entry("#1", #2)}}
\def\xrefgetitem#1{\directlua{tex.write(libgen.xref.get_entry("#1"))}}
\def\xrefclose{\directlua{libgen.xref.finish()}}

\def\label#1{\write-1{\xrefadditem{#1}{\the\pageno}}}
\def\pageref#1{\xrefgetitem{#1}}
