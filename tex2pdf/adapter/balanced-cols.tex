\def\balancedcolstyle{}

\newdimen\colwidth%
\newdimen\rulewidth%
\newdimen\colsgap%
\rulewidth=.4pt%
\colsgap=2.5mm%
\colwidth=\textwidth%
\advance\colwidth by -\rulewidth%
\advance\colwidth by -2\colsgap%
\divide\colwidth by 2%

\makeatletter
\newbox\balanced@col%
\long\def\balancedcols#1{%
	\begingroup%
	\hrule height0pt%
	\setbox\balanced@col=\vbox{\hsize=\colwidth%
		\linewidth=\hsize%
		\balancedcolstyle \vbox to 1cm{}#1}%
	\setbox0=\vsplit\balanced@col to 1cm%
	\balanced@expandColsOverPages%
	\endgroup%
}

\def\balanced@expandColsOverPages{%
	\balanced@setThisPageContent%
	\ifvoid\balanced@col\else\eject\balanced@expandColsOverPages\fi%
}

\newbox\balanced@leftCol%
\newbox\balanced@rightCol%
\def\balanced@setThisPageContent{%
	\vbox to 0pt{}%
	\ifdim\pagetotal>\textheight\eject\fi%
	\balanced@updateCropHeight%
	\balanced@resetDepthStorage%
	\balanced@build\balanced@leftCol from \balanced@col%
	\balanced@build\balanced@rightCol from \balanced@col%
	\balanced@makepage%
}

\def\balanced@makepage{%
	\setbox0=\vbox{\hbox{%
			\box\balanced@leftCol%
			\hskip\colsgap\vrule width\rulewidth\hskip\colsgap%
			\box\balanced@rightCol}}%
	\dimen0=\dp0%
	\advance\dimen0 by -\balanced@depthStorage%
	\ht0=\dimen0\dp0=\balanced@depthStorage%
	\box0%
}

\newdimen\balanced@cropHeight%
\def\balanced@updateCropHeight{%
	\dimen0=\textheight%
	\advance\dimen0 by -\pagetotal%
	\balanced@cropHeight=\ht\balanced@col%
	\divide\balanced@cropHeight by 2%
	\advance\balanced@cropHeight by .5\baselineskip%
	\ifdim\dimen0<\balanced@cropHeight\balanced@cropHeight=\dimen0\fi%
}

\def\balanced@build#1from#2{%
\let\inputBox#2%
\let\outputBox#1%
\setbox\outputBox=\vsplit\inputBox to\balanced@cropHeight%
\balanced@updateDepthStorageWith{\dp\outputBox}%
\setbox\outputBox=\vtop{\unvbox\outputBox}%
\ht\outputBox=-\splittopskip%
}

\newdimen\balanced@depthStorage%
\def\balanced@resetDepthStorage{\balanced@depthStorage=0pt}
\def\balanced@updateDepthStorageWith#1{%
	\ifdim#1>\balanced@depthStorage\balanced@depthStorage=#1\fi
}
\makeatother
